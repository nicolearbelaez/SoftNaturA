{% extends 'usuarios/baseU.html' %}
{% load static %}
{% load humanize %}


{% block title %}Ventas{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'usuarios/css/mis_pedidos-gst_pedidos-ventas.css' %}" />
{% endblock %}

{% block page_id %}ventas{% endblock %}


{% block content %}


<body class="body-ventas">
    <div class="container-ventas">

        <!-- Título -->
        <h1>Lista de Ventas</h1>

        <!-- Cards de resumen -->
        <div class="resumen-cards-ventas">
            <div class="card">
                <div class="card-title">Total Ventas</div>
                <p class="card-value ventas" id="totalVentas">${{ total_ventas|intcomma|default:"0" }}</p>
            </div>
        </div>



        <!-- Búsqueda -->
        <div class="busqueda-ventas">
            <div class="export-container-ventas">
                <button class="btn-export-ventas" id="btnExportar">
                    <i class="fa fa-file-excel"></i>
                    Exportar a Excel
                </button>
            </div>
            <input type="text" class="search-input-ventas" id="searchInput" placeholder="Buscar por ID, cliente o monto...">
        </div>



        <!-- Tabla de ventas -->
        <div class="table-container-ventas">
            <table>
                <!-- Filtros por mes y año -->
                <div class="filtros-container-ventas">
                    <div class="filtro-group">
                        <label class="filtro-label-ventas" for="mesFilter">Mes</label>
                        <select id="mesFilter" class="select-filter-ventas">
                            <option value="">Todos los meses</option>
                            <option value="01">Enero</option>
                            <option value="02">Febrero</option>
                            <option value="03">Marzo</option>
                            <option value="04">Abril</option>
                            <option value="05">Mayo</option>
                            <option value="06">Junio</option>
                            <option value="07">Julio</option>
                            <option value="08">Agosto</option>
                            <option value="09">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>

                    <div class="filtro-group">
                        <label class="filtro-label-ventas" for="anioFilter">Año</label>
                        <select id="anioFilter" class="select-filter-ventas">
                            <option value="">Todos los años</option>
                        </select>
                    </div>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Fecha</th>
                            <th>Monto</th>
                        </tr>
                    </thead>
                    <tbody id="ventasTable">
                        {% for pedido in page_obj %}
                        <tr data-search="{{ pedido.id }} {{ pedido.usuario.nombre|lower }} {{ pedido.total }}"
                            data-fecha="{{ pedido.fecha_creacion|date:'Y-m-d' }}" data-monto="{{ pedido.total }}">
                            <td class="pedido-id">#{{ pedido.id }}</td>
                            <td class="cliente">{{ pedido.usuario.nombre|default:"Sin nombre" }}</td>
                            <td class="fecha">{{ pedido.fecha_creacion|date:"d/m/Y" }}</td>
                            <td class="monto">${{ pedido.total|intcomma|default:"0" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="no-data-ventas">No hay ventas registradas</td>
                        </tr>
                        {% endfor %}
                    </tbody>
            </table>

            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                    <a href="?page=1">&laquo; Primera</a>
                    <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
                    {% endif %}

                    <span class="current">
                        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}">Última &raquo;</a>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</body>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="{% static 'usuarios/js/gst_pedidos-ventas-calificaciones.js' %}"></script>
{% endblock %}