{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      background: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .header{
      margin-left: 1400px;
    }
    /* SIDEBAR */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 220px;
      height: 100%;
      background: #E5BE01;
      color: white;
      padding: 20px 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .sidebar .profile {
      text-align: center;
      margin-bottom: 30px;
    }

    .sidebar .profile i {
      font-size: 60px;
      margin-bottom: 10px;
      color: white;
    }

    .sidebar .profile h3 {
      margin: 0;
      font-size: 18px;
      font-weight: bold;
    }

    .sidebar .profile p {
      font-size: 13px;
      color: white;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: background 0.3s, padding-left 0.2s;
    }

    .sidebar a:hover {
      background: #C79A00;
      color: #fff;
      padding-left: 28px;
    }

    .sidebar a i {
      margin-right: 10px;
    }

    /* Dropdown usuario */
    .user-dropdown {
      margin-bottom: 30px;
      padding: 15px 20px;
      border-top: 1px solid rgba(255, 212, 69, 0.3);
    }

    .user-dropdown a {
      display: block;
      padding: 8px 0;
      font-weight: 5000;
      color: #fff;
      text-decoration: none;
    }


    /* MAIN */
    .main {
      margin-left: 240px;
      padding: 20px;
    }

    .main h1 {
      color: #1f2933;
    }

    /* CARDS */
    .cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
      text-align: center;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-3px);
      background: #FFF59D;
    }

    .card h3 {
      font-size: 16px;
      color: #6B7280;
    }

    .card p {
      font-size: 22px;
      font-weight: bold;
      color: #8C6A00;
      margin: 8px 0 0;
    }

    /* CHARTS */
    .charts {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
    }

    .chart-card h2 {
      margin-bottom: 10px;
      font-size: 18px;
      color: #1f2933;
    }

    /* TABLES */
    .table-card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th,
    td {
      padding: 10px;
      text-align: center;
    }

    th {
      background: #E5BE01;
      color: #1f2933;
    }

    tr:nth-child(even) {
      background: #FFF7D6;
    }
  </style>
</head>

<body>
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div>
      <div class="profile">
        <i class="fa fa-user-circle"></i>
        <h3>{{ request.user.nombre }}</h3>
        <p>{{ request.user.email }}</p>
      </div>
      <a href="{% url 'usuarios:gstUsuarios' %}"><i class="fa fa-users"></i> Usuarios</a>
      <a href="{% url 'productos:listProduc' %}"><i class="fa fa-box"></i> Productos</a>
      <a href="{% url 'usuarios:informe_calificaciones' %}"><i class="fa fa-chart-line"></i> Informes</a>
      <a href="{% url 'usuarios:pedidos' %}"><i class="fa fa-shopping-cart"></i> Pedidos</a>
    </div>
    <div class="user-dropdown" id="userDropdown">
      <a href="{% url 'usuarios:editar_perfil' %}"><i class="fa fa-user-edit"></i> Editar perfil</a>
      <a href="{% url 'usuarios:logout' %}"><i class="fa fa-sign-out-alt"></i> Cerrar sesión</a>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <input class="header" type="text" placeholder="Buscar...">
    <h1>Dashboard Administrador</h1>

    <!-- CARDS -->
    <div class="cards">
      <div class="card">
        <h3>Ventas</h3>
        <p>${{ total_ventas|default:"0" }}</p>
      </div>
      <div class="card">
        <h3>Productos</h3>
        <p>{{ total_productos|default:"0" }}</p>
      </div>
      <div class="card">
        <h3>Usuarios</h3>
        <p>{{ total_usuarios|default:"0" }}</p>
      </div>
      <div class="card">
        <h3>Pedidos</h3>
        <p>{{ total_pedidos|default:"0" }}</p>
      </div>
    </div>

    <!-- GRÁFICAS -->
    <div class="charts">
      <div class="chart-card">
        <h2>Ventas por Mes</h2>
        <canvas id="ventasChart"></canvas>
      </div>
      <div class="chart-card">
        <h2>Progreso</h2>
        <canvas id="progressChart"></canvas>
      </div>
    </div>

    <!-- TABLAS -->
    <div class="table-card">
      <h2>Ventas Realizadas</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Total</th>
            <th>Método</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          {% for venta in ventas %}
          <tr>
            <td>{{ venta.id }}</td>
            <td>{{ venta.cliente.username }}</td>
            <td>{{ venta.fecha|date:"d/m/Y" }}</td>
            <td>${{ venta.total }}</td>
            <td>{{ venta.metodo_pago }}</td>
            <td>{{ venta.estado_pago }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6">No hay ventas registradas</td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- MENSAJES RECIENTES -->
    <div class="card">
      <h2>Últimos Mensajes de Contacto</h2>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Asunto</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          {% for m in Mensajes %}
          <tr>
            <td>{{ m.nombre }}</td>
            <td>{{ m.correo }}</td>
            <td>{{ m.asunto }}</td>
            <td>{{ m.fecha_envio|date:"d/m/Y H:i" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4">No hay mensajes recientes</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <!-- CHARTS JS -->
  <script>
    new Chart(document.getElementById('ventasChart'), {
      type: 'bar',
      data: {
        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
        datasets: [{
          label: 'Ventas',
          data: [120, 200, 150, 300, 250, 400],
          backgroundColor: '#C79A00'
        }]
      }
    });

    new Chart(document.getElementById('progressChart'), {
      type: 'doughnut',
      data: {
        labels: ['Completado', 'Pendiente'],
        datasets: [{
          data: [65, 35],
          backgroundColor: ['#E5BE01', '#FFF59D']
        }]
      },
      options: {
        cutout: '70%',
        plugins: {
          legend: { display: false }
        }
      }
    });
  </script>
</body>

</html>